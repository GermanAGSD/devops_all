–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π control plane –≤ –∫–ª–∞—Å—Ç–µ—Ä


–û—Ç–ª–∏—á–Ω–æ ‚Äî —É —Ç–µ–±—è —É–∂–µ –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –æ–¥–Ω–æ–≥–æ control plane.
–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π (–∏–ª–∏ —Ç—Ä–µ—Ç–∏–π) control plane –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Ç–µ—Ä Kubernetes, –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏, –æ—Ç–ª–∏—á–Ω—ã–µ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ kubeadm join.
üëá –ù–∏–∂–µ –ø—Ä–∏–≤–æ–∂—É —Ç–æ—á–Ω—É—é, —Ä–∞–±–æ—á—É—é —Å—Ö–µ–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –µ—â—ë –æ–¥–Ω–æ–≥–æ control-plane —É–∑–ª–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ kubeadm.

üß≠ –û–±—â–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ

Worker-–Ω–æ–¥—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –æ–±—ã—á–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

kubeadm join <API_SERVER>:6443 --token ... --discovery-token-ca-cert-hash ...


Control Plane-–Ω–æ–¥—ã ‚Äî –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–ª—é—á–∏ –¥–ª—è etcd –∏ API-—Å–µ—Ä–≤–µ—Ä–∞,
–ø–æ—ç—Ç–æ–º—É –∫–æ–º–∞–Ω–¥–∞ –¥—Ä—É–≥–∞—è:

kubeadm join <API_SERVER>:6443 --token ... --discovery-token-ca-cert-hash ... \
  --control-plane --certificate-key <CERT_KEY>

‚öôÔ∏è –®–∞–≥–∏ –Ω–∞ –ø–µ—Ä–≤–æ–º (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º) control-plane
1Ô∏è‚É£ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–æ–∫–µ–Ω –∏ –∫–ª—é—á —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo kubeadm token create --print-join-command


–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç —Å—Ç—Ä–æ–∫—É –Ω–∞–ø–æ–¥–æ–±–∏–µ:
kubeadm join 172.30.30.68:6443 --token 240ehu.ioojes260deubrfo --discovery-token-ca-cert-hash sha256:b4f3310996fda61b7c6c24bdec7af45a2193d208134f708e1d2fd177f9bdee85



–¢–µ–ø–µ—Ä—å —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π certificate key (–Ω—É–∂–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π control-plane):

sudo kubeadm init phase upload-certs --upload-certs


–í—ã–≤–æ–¥ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–º:

certificate key: aa6c709c719bef84f7e9cbe1214f4fcedb9c8b897762ceecaeda8a57882d0b1c


–ó–∞–ø–æ–º–Ω–∏ –µ–≥–æ ‚Äî —ç—Ç–æ CERT_KEY.

üöÄ –®–∞–≥–∏ –Ω–∞ –Ω–æ–≤–æ–º control-plane —É–∑–ª–µ
2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏ –≤—Å—ë —Ç–æ –∂–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (containerd, kubeadm, kubelet, kubectl)

–¢—ã —É–∂–µ –ø—Ä–∏–≤—ë–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–æ–º–∞–Ω–¥ ‚Äî –≤—ã–ø–æ–ª–Ω–∏ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ –Ω–æ–≤–æ–º —É–∑–ª–µ, –¥–æ kubeadm init.

–ù–æ –≤–º–µ—Å—Ç–æ kubeadm init –¥–µ–ª–∞–π –≤–æ—Ç —Ç–∞–∫:

sudo kubeadm join 172.30.30.250:6443 \
  --token d84102.eu2c9aibmatoju7m \
  --discovery-token-ca-cert-hash sha256:b4f3310996fda61b7c6c24bdec7af45a2193d208134f708e1d2fd177f9bdee85 \
  --control-plane \
  --certificate-key ea3f05c198cadf9b580df77394fd35e53fe0b5d59c66146aa09abff424f78f34 \
  --cri-socket=unix:///run/containerd/containerd.sock


üìå –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω—ã–π:

sudo kubeadm join 10.0.0.10:6443 \
  --token abcdef.0123456789abcdef \
  --discovery-token-ca-cert-hash sha256:9d2fd15886eb176466640067f361ed2295de381 \
  --control-plane \
  --certificate-key 1f88aebd0b49724c31c3bff2e7f768f7de6c6d4ad52c5e4c1f72b6a8b09f8f03 \
  --cri-socket=unix:///run/containerd/containerd.sock

üß© –ü–æ—Å–ª–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
3Ô∏è‚É£ –ù–∞ –Ω–æ–≤–æ–º control-plane –Ω–∞—Å—Ç—Ä–æ–π kubectl:
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ù–∞ –ª—é–±–æ–º control-plane:

kubectl get nodes


–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å:

NAME     STATUS   ROLES           AGE   VERSION
node1    Ready    control-plane   2d    v1.33.2
node2    Ready    control-plane   1m    v1.33.2

üîÅ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–µ—É–¥–∞—á–Ω–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:
sudo kubeadm reset --cri-socket=unix:///run/containerd/containerd.sock
sudo rm -rf /etc/kubernetes /var/lib/etcd

üí° (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è kubeconfig –º–µ–∂–¥—É control-plane

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –≤—Å–µ control-plane-–Ω–æ–¥—ã –º–æ–≥–ª–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–æ–º –æ–¥–∏–Ω–∞–∫–æ–≤–æ:

scp /etc/kubernetes/admin.conf node2:/etc/kubernetes/admin.conf


(–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å rsync, ssh-copy).

–•–æ—á–µ—à—å, —è —Å–¥–µ–ª–∞—é –≥–æ—Ç–æ–≤—ã–π bash-—Å–∫—Ä–∏–ø—Ç add-control-plane.sh,
–∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –Ω–æ–≤–æ–º —É–∑–ª–µ –∏ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –∫–ª–∞—Å—Ç–µ—Ä—É,
–µ—Å–ª–∏ —Ç—ã –≤–≤–µ–¥—ë—à—å TOKEN, HASH, –∏ CERT_KEY?
